------lvs的四种ip负载均衡技术

1. VS/NAT
	在一组服务器前有一个调度器，它们是通过switch/hub相连接的。即
	Load Balancer ==> switch/hub ==> Real Server[1..n]
	客户通过vip访问网络服务时，请求报文到达调度器，调度器根据连接调度算法从一组真实服务器中选出一台服务器。
  将报文的目标地址vip改写成选定服务器的地址，报文的目标端口改写成选定服务器的相应端口，最后将修改后的报文发送给
  选出的服务器。同时，调度器在连接hash表中记录这个连接，当这个连接的下一个报文到达时，从连接hash表中可以得到原
  选定服务器的地址和端口，进行同样的改写操作，并将报文传给原选定的服务器。当来自真实服务器的响应报文经过调度器时，
  调度器将报文的源地址和源端口改为vip和相应端口，再把报文转发给用户。我们在连接上引入了一个状态机，不同的报文会
  使得连接处于不同状态，不同状态会有不同的超时值。在tcp连接中，根据标准的tcp有限状态机进行状态迁移。

	请求和响应的数据报文都需要经过负载调度器，当真实服务器的数目在10-20之间时，负载调度器将成文整个集群系统
  的新瓶颈。
2. VS/TUN	ip隧道
	ip隧道主要用于移动主机和虚拟私有网络，在其中隧道都是静态建立的
	它的连接调度和管理与VS/NAT中的一样，只是它的报文转发方法不同。调度器根据各个服务器的负载情况，动态的选择一台
  服务器，将请求报文封装在另一个IP报文中，再将封装后的ip报文转发给选出的服务器；服务器收到报文后，先将报文解封获得原来
  目标地址为vip的报文，服务器发现vip地址被配置在本地的ip隧道设备上，所以就处理这个请求，然后根据路由表将响应报文直接返回
  给客户。
	在这里需要指出的是，根据缺省的tcp/ip协议栈处理，请求报文的目标地址为vip，响应报文的源地址肯定也为vip，所以响应
  报文不需要做任何修改，可以直接返回给客户，客户认为得到正常服务，而不会知道究竟是那一台服务器处理的。
3. VS/DR	直接路由
	跟VS/TUN相同，负载调度器只负责调度请求，而服务器直接将响应返回给客户，可以极大的提高整个集群系统的吞吐量。
	调度器和服务器组都必须在物理上有一个网卡通过不分断的局域网相连，如通过高速的交换机或者hub相连。vip地址为调度器和
  服务器共享，调度器配置的vip地址对外是可见的，用于接收虚拟服务的请求报文；所有的服务器把vip地址配置在各自的non-arp网络设备
  上，它对外面是不可见的，只是用于处理目标地址为vip的网络请求
	它的连接调度和管理与vs/nat和vs/tun中的一样，它的报文转发方式又有不同，将报文直接路由给目标服务器。在vs/dr中，调度器
  根据各个服务器的负载情况，动态的选择一台服务器，不修改也不封装ip报文，而是将数据帧的mac地址改为选出的服务器的mac地址，再
  将修改后的数据帧在与服务器组的局域网上发送。因为数据帧的mac地址是选出的服务器，所以服务器肯定可以收到这个数据帧，从中可以获得
  这个该ip报文，当服务器发现报文的目标地址vip是在本地的网络设备上，服务器处理这个报文，然后根据路由表将响应报文直接返回给客户。
	和vs/tun一样，请求报文的目标地址为vip，响应报文的源地址肯定也为vip，所以响应报文不需要作任何修改，可以直接返回给客户，
  客户认为得到正常的服务，而不会知道是哪一台服务器处理的
4. 三种方法的优缺点
	-		VS/NAT		VS/TUN		VS/DR
	Server		any		Tunneling	Non-arp device
	server network	private		LAN/WAN		LAN
	server number	loc(10~20)	High(100)	High(100)
	server gateway	load balancer	own router	own router
5. FULLNAT lvs
    三层设备和lvs机群之间ospf
    lvs机群和后端之间能够跨vlan，因此需要patch lvs的内核，因此lvs能够摆脱vlan限制
